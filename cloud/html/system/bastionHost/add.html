<div class="content_center">
	<div class="content_center_content">
		<table
			cellpadding="0"
			cellspacing="0"
			border="0"
			id="configBastionHostTable"
			class="table table-bordered table-hover"
			style="width:50%;margin: 20px auto;"
		>
			<thead>
				<tr>
					<th width="35%">ip地址</th>
					<th width="50%">地址备注</th>
					<th>操作</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>
						<div class="form-group" style="margin-bottom: 0">
							<input
								id="configBastionHost_ip"
								name="ip"
								class="form-control configBastionHost_ip"
								type="text"
								placeholder="IP地址"
								autocomplete="off"
							/>
						</div>
					</td>
					<td>
						<div class="form-group" style="margin-bottom: 0">
							<input
								id="configBastionHost_ipRemark"
								name="ipRemark"
								class="form-control configBastionHost_ipRemark"
								type="text"
								placeholder="地址备注"
								autocomplete="off"
							/>
						</div>
					</td>
					<td>
						<div class="form-group" style="margin-bottom: 0">
							<!-- <a class="fa fa-trash-o" title="删除" style="font-size: 20px;margin-right: 15px;"></a>  -->
							<a
								class="glyphicon glyphicon-plus operation a_size"
								title="增加"
								style="font-size: 20px;"
								onclick="addWhiteList()"
							></a>
						</div>
					</td>
				</tr>
			</tbody>
		</table>
	</div>
</div>
<div class="modal-footer">
	<button type="button" class="btn btn-default" data-dismiss="modal">
		取消
	</button>
	<button
		type="button"
		class="btn btn-primary"
		onclick="bastionHost_doSubmit()"
	>
		确定
	</button>
</div>
<script type="text/javascript">
	var whiltListNum = 0;
	$(function() {
		Ewin.dialog({ message: "你好" });
	});
	// 增加白名单
	function addWhiteList() {
		whiltListNum++;
		if (whiltListNum < 10) {
			var rowId = "whiltListNum" + whiltListNum;
			var insertStr =
				'<tr id="' +
				rowId +
				'">' +
				"<td>" +
				'<div class="form-group" style="margin-bottom: 0">' +
				'<input id="configBastionHost_ip" name="ip" class="form-control configBastionHost_ip" type="text" placeholder="IP地址" autocomplete="off">' +
				"</div>" +
				"</td>" +
				"<td>" +
				'<div class="form-group" style="margin-bottom: 0">' +
				'<input id="configBastionHost_ipRemark" name="ipRemark" class="form-control configBastionHost_ipRemark" type="text" placeholder="地址备注" autocomplete="off">' +
				"</div>" +
				"</td>" +
				"<td>" +
				'<div class="form-group" style="margin-bottom: 0">' +
				'<a class="fa fa-trash-o" title="删除" style="font-size: 20px;" onclick="delWhiteList(\'' +
				rowId +
				"')\"></a>" +
				"</div>" +
				"</td>" +
				"</tr>";
			$("#configBastionHostTable tbody").append(insertStr);
		} else {
			Ewin.alert({
				message: "最多配置10个白名单"
			});
		}
	}
	// 删除白名单
	function delWhiteList(rowId) {
		whiltListNum--;
		$("#" + rowId).remove();
	}
	// 提交
	function bastionHost_doSubmit() {
		var submitParam = [];
		var ipList = $(".configBastionHost_ip");
		var remarkList = $(".configBastionHost_ipRemark");
		var flag = true;
		var reg = /^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;
		if (
			ipList.length == 1 &&
			ipList[0].value == "" &&
			remarkList[0].value.length <= 0
		) {
			Ewin.alert({
				message: "请输入IP和地址备注"
			});
			return;
		}
		for (var i = 0; i < ipList.length; i++) {
			var ip = ipList[i].value;
			var remark = remarkList[i].value;
			if (!reg.test(ip) && ip != "" && remark.length != 0) {
				Ewin.alert({
					message: "请输入正确格式的IP地址,例如:0.0.0.0"
				});
				return;
			}
			if (remark.length <= 0 && ip != "") {
				Ewin.alert({
					message: "地址备注不能为空"
				});
				return;
			}
			if (remark.length > 32) {
				Ewin.alert({
					message: "地址备注不能超过32位"
				});
				return;
			}
			for (var j = 0; j < ipList.length; j++) {
				var ip_j = ipList[j].value;
				if (ip_j === ip && i !== j) {
					flag = false;
				}
			}
			if (ip == "" && remark.length <= 0) {
				continue;
			}
			submitParam.push({
				ip: $(ipList[i]).val(),
				remark: $(remarkList[i]).val()
			});
		}

		if (!flag) {
			Ewin.alert({
				message: "ip不能重复"
			});
			flag = true;
			return false;
		}
		if (submitParam.length == 0) {
			Ewin.alert({
				message: "ip不能为空"
			});
			return false;
		}

		sendAjax(
			"POST",
			host_url + "/cloud-web/pubBastionHost/addWhite",
			{ params: JSON.stringify(submitParam) },
			function(res) {
				Ewin.dialog({
					url:
						"../../../html/system/bastionHost/tip.html?res=" +
						JSON.stringify(res),
					title: "温馨提示",
					width: 550
				});
			}
		);
	}
</script>
