<link rel="stylesheet" href="../../../css/lib/daterangepicker-bs3.css" />
<link rel="stylesheet" href="../../../css/lib/bootstrap-table.min.css" />
<div class="content_center">
	<div class="content_center_content">
		<!--查询条件-->
		<div class="content_center_condition">
			<form id="paymentRush_Form" name="paymentRush_Form" role="form" class="form-inline">
				<div class="form-group customerNo">
					<label class="control-label">平台号：</label>
					<input name="customerNo" class="form-control" type="text" placeholder="平台号" autocomplete="off" />
				</div>
				<div class="form-group customerName">
					<label class="control-label">平台名称：</label>
					<input name="customerName" class="form-control" type="text" placeholder="平台名称" autocomplete="off" />
				</div>
				<div class="form-group">
					<label class="control-label">原平台流水号：</label>
					<input name="tradeOrderNo" class="form-control" type="text" placeholder="原平台流水号"
						autocomplete="off" />
				</div>
				<div class="form-group">
					<label class="control-label">冲账流水号：</label>
					<input type="text" name="orderNo" class="form-control" type="text" placeholder="冲账流水号"
						autocomplete="off" />
				</div>
				<div class="form-group">
					<label class="control-label">冲账状态：</label>
					<select class="form-control" id="paymentRush_status" name="status"></select>
				</div>
				<div class="form-group">
					<label class="control-label">创建日期：</label>
					<input type="text" name="paymentRush_CreateTime" id="paymentRush_CreateTime"
						class="form-control dateranges" placeholder="创建日期" autocomplete="off" readonly="readonly" />

				</div>
				<div class="form-group pull-right">
					<button id="paymentRush_button" type="button" class="btn btn-primary refreshBtn">
						<i class="fa fa-search"></i>查询
					</button>
					<button type="reset" class="btn btn-default">
						<i class="fa fa-refresh"></i> 重置
					</button>
				</div>
				<div class="clearfix"></div>
			</form>
		</div>
		<div class="content_center_table">
			<button type="button" class="btn btn-primary" onclick="paymentRush_download()" style="margin-bottom: 6px;">
				导出excel
			</button>
			<table cellpadding="0" cellspacing="0" border="0" id="paymentRush_Table"
				class="table table-bordered table-hover"></table>
		</div>
	</div>
</div>
<style type="text/css">
	#paymentRush_Table.table {
		width: 2000px;
	}
</style>
<script>
	$(function () {
		listOptionInit($("#paymentRush_status"), C_STATUS);
		$("#paymentRush_status").comboSelect();
		$("#paymentRush_CreateTime").daterangepicker({
			timePicker: true,
			timePickerIncrement: 1,
			format: "YYYY-MM-DD HH:mm:ss",
			// startDate: startDate,
			// endDate: endDate,
			opens: "center"
		},
			function (start, end, label) { }
		);
		paymentRush_Table();
	});

	// 搜索
	$("#paymentRush_button").click(function () {
		$("#paymentRush_Table").bootstrapTable("refresh");
	});
	/*表格加载*/
	function paymentRush_Table() {
		$("#paymentRush_Table").bootstrapTable({
			url: host_url + "/cloud-web/coreRushAcctFlow/pageList",
			method: "GET",
			dataType: "json",
			contentType: "application/x-www-form-urlencoded;charset=UTF-8",
			pagination: true, //在表格底部显示分页工具栏
			pageNumber: 1,
			pageList: [20, 50, 100],
			clickToSelect: true,
			sidePagination: "server", //表格分页的位置
			cache: false, //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
			locale: "zh-CN", //中文支持
			queryParamsType: "limit",
			queryParams: function (params) {
				params.pageSize = params.limit; //页面大小
				params.page = params.offset / params.limit + 1; //页码
				params._sys_login_token = _get_sys_login_token();

				var paramForm = $("#paymentRush_Form").serializeArray();
				$.each(paramForm, function (i, param) {
					params[param.name] = $.trim(param.value);
				});
				params.rushType = 20;
				if (params.paymentRush_CreateTime) {
					params.startTime = params.paymentRush_CreateTime.substring(
						0,
						19
					);
					params.endTime = params.paymentRush_CreateTime.substring(
						21,
						41
					);
				}
				delete params.paymentRush_CreateTime;
				//params.authStatus = 100;
				return params;
			}, //参数
			columns: [
				{
					title: "序号",
					width: 30,
					align: "center",
					valign: "middle",
					formatter: function (value, row, index) {
						var options = $("#paymentRush_Table").bootstrapTable(
							"getOptions"
						);
						return (
							(options.pageNumber - 1) * options.pageSize +
							index +
							1
						);
					}
				},
				{
					field: "customerNo",
					title: "平台号",
					width: 80,
					align: "center",
					valign: "middle"
				},
				{
					field: "customerName",
					title: "平台名称",
					width: 80,
					align: "center",
					valign: "middle"
				},
				{
					field: "cusOrderNo",
					title: "客户单号",
					width: 160,
					align: "center",
					valign: "middle"
				},
				{
					field: "tradeOrderNo",
					title: "原平台流水号",
					width: 150,
					align: "center",
					valign: "middle"
				},
				{
					field: "orderNo",
					title: "冲账流水号",
					width: 150,
					align: "center",
					valign: "middle"
				},
				{
					field: "rushAmt",
					title: "冲账金额(元)",
					width: 80,
					align: "right",
					valign: "middle",
					formatter: function (value, row, index) {
						return formatterMoney(value, 2);
					}
				},
				{
					field: "orderAmt",
					title: "订单金额(元)",
					width: 80,
					align: "right",
					valign: "middle",
					formatter: function (value, row, index) {
						return formatterMoney(value, 2);
					}
				},
				{
					field: "payAmt",
					title: "提款金额(元)",
					width: 80,
					align: "right",
					valign: "middle",
					formatter: function (value, row, index) {
						return formatterMoney(value, 2);
					}
				},
				{
					field: "operatorName",
					title: "操作员",
					width: 100,
					align: "center",
					valign: "middle"
				},
				{
					field: "returnMsg",
					title: "冲账原因",
					width: 120,
					align: "center",
					valign: "middle"
				},
				{
					field: "authName",
					title: "复核人",
					width: 100,
					align: "center",
					valign: "middle"
				},
				{
					field: "authRemark",
					title: "复核备注",
					width: 150,
					align: "center",
					valign: "middle"
				},
				{
					field: "status",
					title: "冲账状态",
					width: 80,
					align: "center",
					valign: "middle",
					formatter: function (value, row, index) {
						return visualParams(C_STATUS, value);
					}
				},
				{
					field: "authTime",
					title: "审核时间",
					width: 150,
					align: "center",
					valign: "middle",
					formatter: function (value, row, index) {
						return getDateStr(value);
					}
				},
				{
					field: "createTime",
					title: "创建时间",
					width: 150,
					align: "center",
					valign: "middle",
					formatter: function (value, row, index) {
						return getDateStr(value);
					}
				}
			],
			onClickRow: function (row, $element) {
				$($element)
					.addClass("table_info")
					.siblings()
					.removeClass("table_info");
			},
			onLoadSuccess: function (res) {
				//加载成功时执行
			}
		});
	}

	function paymentRush_download() {
		var params = {};
		var paramForm = $("#paymentRush_Form").serializeArray();
		$.each(paramForm, function (i, param) {
			params[param.name] = $.trim(param.value);
		});
		if (params.paymentRush_CreateTime) {
			params.startTime = params.paymentRush_CreateTime.substring(0, 19);
			params.endTime = params.paymentRush_CreateTime.substring(21, 41);
		}
		delete params.paymentRush_CreateTime;
		params.rushType = 20;
		var url = "";
		$.each(params, function (i, item) {
			url += "&" + i + "=" + item;
		});
		sendAjax('POST', host_url + "/cloud-web/corePayTradeFlow/checkDown", {}, function (res) {
			window.location.href =
				host_url +
				"/cloud-web/coreRushAcctFlow/down?_sys_login_token=" +
				_get_sys_login_token() +
				url;
		});
	}
</script>